#                                    __   __  __
#                                    \ \ / / / /
#                                     \ V / / /
#                                      \_/  \/
#
#                                    V E C T O R
#                                   Configuration
#
# ------------------------------------------------------------------------------
# Website: https://vector.dev
# Docs: https://vector.dev/docs
# Chat: https://chat.vector.dev
# ------------------------------------------------------------------------------

# Change this to use a non-default directory for Vector data storage:
# data_dir: "/var/lib/vector"
api:
  enabled: true

sources:
  agent_logs:
    type: vector
    address: "0.0.0.0:9000"

transforms:
  add_server_metadata:
    type: remap
    inputs:
      - agent_logs
    source: |
      .host = host().hostname
      .received_at = now()
      .pipeline_stage = "receive"

  for_siem:
    type: filter
    inputs:
      - add_server_metadata
    condition: '.log_type in ["auth", "audit", "system", "sshd", "journal"]'

  for_app:
    type: filter
    inputs:
      - add_server_metadata
    condition: '.log_type in ["nginx", "docker", "app"]'

sinks:
  to_siem:
    type: file
    inputs:
      - for_siem
    path: "/var/log/vector/siem_logs.json"
    encoding:
      codec: json

  to_kafka:
    type: kafka
    inputs:
      - for_app
    bootstrap_servers: "10.0.2.2:9092"
    topic: "app_logs"
    encoding:
      codec: json